<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of IBM

  WebSphere Commerce

  (C) Copyright IBM Corp. 2013 All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or
  disclosure restricted by GSA ADP Schedule Contract with
  IBM Corp.
 =================================================================
-->

<Definitions> 
	<!---
            This definition defines the base object from which ContentPageFolder and InheritedContentPageFolder are derived.
            A Content Page folder is an object used to organize Content Pages so that they can be found easily.
            Content Pages can only be in one folders at a time.
            This class uses a reference object definition to define the relationship between folders and Content Pages.
            Content Page folders use the Folder noun from the file wc-infrastructure-clientobjects.xml
            which contains information on how the parameters in the services
            are mapped to create the appropriate BOD for the Web services.
	-->

      <PrimaryObjectDefinition
            definitionName="plmBaseContentPageFolderPrimaryObjectDefinition"
            displayName="${plmPageLayoutResources.ContentPageFolderObjectName}"
            displayNameProperty="identifier"
            idProperty="folderId"
            isBaseDefinition="true"
            newDisplayName="${plmPageLayoutResources.ContentPageFolder_newContentPageFolderDisplayName}"
            newObjectMenuItemText="${plmPageLayoutResources.contextMenuNewContentPageFolder}"
            objectGroups="ContentPageFolderGroup"
            propertiesDefinitionName="plmContentPageFolderProperties"
            writeUsage="IBM_ManagePageComposerTool"> 
           
            <!--- This service retrieves all the child folders.  -->
            <GetChildrenService objectTypes="ContentPageFolderReference,InheritedContentPageFolderReference" url="/cmc/GetChildFolders">
                  <ServiceParam name="storeId"/>
                  <ServiceParam name="folderId" propertyName="folderId"/>
                  <ServiceParam name="folderObjectType" value="ContentPageFolder"/>
            </GetChildrenService>
           
            <!--- This service retrieves all the folder items that belong to this folder. -->
            <GetChildrenService objectTypes="ContentPageFolderItemReference,ContentPageFolderInheritedItemReference,InheritedContentPageFolderInheritedItemReference" url="/cmc/GetPageComposerFolderItems">
                  <ServiceParam name="storeId"/>
                  <ServiceParam name="folderId" propertyName="folderId"/>
                  <ServiceParam name="defaultLanguageId"/>
            </GetChildrenService>
			
			<ObjectTypeFilter filterType="utilitiesViewFilter" objectTypes="ContentPageFolderReference,InheritedContentPageFolderReference,ContentPageFolderItemReference,ContentPageFolderInheritedItemReference,InheritedContentPageFolderInheritedItemReference"/>
			
           	<!--- Update service to update a folder. -->
            <UpdateService url="/cmc/UpdateFolder">
                  <ServiceParam name="storeId" />
                  <ServiceParam name="objectStoreId" propertyName="objectStoreId"/>
                  <ServiceParam name="folderId" propertyName="folderId"/>
                  <ServiceParam name="parentFolderId" optional="true" parameterName="parentFolderId" parentProperty="true" propertyName="folderId"/>
            </UpdateService>
           
            <!---
                  Retrieves the plmBaseContentPageFolderPrimaryObjectDefinition object that is the parent to this object.
            -->
            <GetReferencesService url="/cmc/GetParentFolder">
                  <ServiceParam name="storeId"/>
                  <ServiceParam name="objectStoreId" propertyName="objectStoreId"/>
                  <ServiceParam name="folderId" propertyName="folderId"/>
                  <ServiceParam name="parentFolderId" propertyName="parentFolderId"/>
                  <ServiceParam name="folderObjectType" value="ContentPageFolder"/>
            </GetReferencesService>
           
            <!-- Refresh Service to reload the properties of the folder -->
            <RefreshService url="/cmc/GetFolderById">
            <ServiceParam name="storeId"/>
            <ServiceParam name="folderId" propertyName="folderId"/>
            <ServiceParam name="folderObjectType" value="ContentPageFolder"/>
            </RefreshService>
           
            <!--- This is the folder_id defined in the FOLDER table, which indicates the primary key of this folder. -->
            <PropertyDefinition copyProtected="true" propertyName="folderId"/>
           
            <!--- This is the identifier of the folder. -->
            <PropertyDefinition displayName="${plmPageLayoutResources.ContentPageFolder_name}" maximumSize="256" propertyName="identifier" required="true" trim="true"/>
           
            <!--- This is the description of the folder. -->
            <PropertyDefinition displayName="${plmPageLayoutResources.ContentPageFolder_description}" maximumSize="256" propertyName="description" type="string"/>
           
            <Xml name="template">
                  <folderType>IBM_ContentPageFolder</folderType>              
            </Xml>
            
            <!--- Reference to the parent of the folder. -->
            <ParentReferenceObjectDefinition cascadeDelete="true" baseDefinitionName="plmContentPageFolderReferenceObjectDefinition"/>
            
            <!--- Navigation list definition for navigating from the folder item to the Content. -->
            <NavigationListDefinition baseDefinitionName="plmContentPageFolderItemGridChildList" isDefault="true"/>
           
            <!--- Navigation list definition for navigating from the folder to its child items. -->
            <NavigationListDefinition baseDefinitionName="plmContentPageFolderGridChildList" toolbarIcon="folderListToolbarIcon"/>  
                                                     
      </PrimaryObjectDefinition>
      
      <!--
            Defines the object to be used to represent folders owned by the local store.
       -->
      <PrimaryObjectDefinition baseDefinitionName="plmBaseContentPageFolderPrimaryObjectDefinition"
      		creatable="true"
      		definitionName="ContentPageFolder"
      		objectType="ContentPageFolder"
      		headerIcon="GenericFolderHeaderIcon"
      		icon="GenericFolderIcon"
      		utilitiesListDefinitionName="plmContentPageFolderBrowseGrid">
      		
      		<!--- Create service to create a folder and its relationship to a parent folder.. -->
            <CreateService url="/cmc/CreateFolder">
                  <ServiceParam name="storeId" />
                  <ServiceParam name="objectStoreId" propertyName="objectStoreId"/>
                  <ServiceParam name="parentFolderId" optional="false" parameterName="parentFolderId" parentProperty="true" propertyName="folderId">
                  		<EnablementCondition conditionId="enableParentFolderId" negate="true" enablementValue="" propertyName="identifier" parentProperty="true"/>
                  </ServiceParam>
            </CreateService>
      		
      		<!--- Delete service to delete a folder. -->
            <DeleteService url="/cmc/DeleteFolder">
                  <ServiceParam name="storeId" />
                  <ServiceParam name="folderId" propertyName="folderId"/> 
            </DeleteService>
      		
            <TrueEnablementCondition /> 
      		
            <!--- Collection reference to the items that belong to the folder and are owned by the local store. -->
            <CollectionReferenceObjectDefinition baseDefinitionName="plmContentPageFolderItemReferenceObjectDefinition"/>
           
            <!--- Collection reference to the items that belong to the folder and are owned by the asset store. -->
            <CollectionReferenceObjectDefinition baseDefinitionName="plmContentPageFolderInheritedItemReferenceObjectDefinition"/>
      </PrimaryObjectDefinition>
      
      <!--
            Defines the object to be used to represent folders owned by the asset store.
       -->
      <PrimaryObjectDefinition baseDefinitionName="plmBaseContentPageFolderPrimaryObjectDefinition" compatibleObjectTypes="ContentPageFolder" creatable="false" definitionName="InheritedContentPageFolder" objectType="InheritedContentPageFolder" headerIcon="InheritedGenericFolderHeaderIcon" icon="InheritedGenericFolderIcon">
            <!--- Reference to the parent of the folder. -->
            <ParentReferenceObjectDefinition baseDefinitionName="plmInheritedContentPageFolderReferenceObjectDefinition"/>
 
            <!--- Collection reference to the items that belong to the folder and are owned by the asset store. -->
            <CollectionReferenceObjectDefinition baseDefinitionName="plmInheritedContentPageFolderInheritedItemReferenceObjectDefinition"/>
      </PrimaryObjectDefinition>
      
      <!-- The relationship between this folder and its local parent -->           
      <ParentReferenceObjectDefinition definitionName="plmContentPageFolderReferenceObjectDefinition" derivedId="true" idProperty="folderReferenceId" objectGroups="ContentPageFolderReferenceGroup" objectType="ContentPageFolderReference" referencedType="ContentPageFolder" cascadeDelete="true"/>
      
      <!-- The relationship between this folder and its asset store parent -->
      <ParentReferenceObjectDefinition definitionName="plmInheritedContentPageFolderReferenceObjectDefinition" derivedId="true" idProperty="folderReferenceId" objectGroups="ContentPageFolderReferenceGroup" objectType="InheritedContentPageFolderReference" referencedType="InheritedContentPageFolder" cascadeDelete="true"/>
      
      <!-- The relationship between a folder and local Content Page in this folder. -->
      <CollectionReferenceObjectDefinition baseDefinitionName="plmBaseContentPageFolderItemReferenceObjectDefinition" initializeObjectStoreId="true"  objectGroups="ContentPageFolderItemReferenceGroup" definitionName="plmContentPageFolderItemReferenceObjectDefinition" objectType="ContentPageFolderItemReference" referencedTypes="ContentPage">
            <TrueEnablementCondition  conditionType="childObjectCondition"/>
      </CollectionReferenceObjectDefinition>
      
      <!-- The relationship between this folder and asset store Content Page in this folder. -->
      <CollectionReferenceObjectDefinition baseDefinitionName="plmBaseContentPageFolderItemReferenceObjectDefinition" initializeObjectStoreId="true" objectGroups="ContentPageFolderItemReferenceGroup" definitionName="plmContentPageFolderInheritedItemReferenceObjectDefinition" objectType="ContentPageFolderInheritedItemReference" referencedTypes="InheritedContentPage">
            <TrueEnablementCondition conditionType="childObjectCondition"/>
      </CollectionReferenceObjectDefinition>
      
      <!-- The relationship between an inherited folder and an inherited Content Page in this folder. -->
      <CollectionReferenceObjectDefinition baseDefinitionName="plmBaseContentPageFolderItemReferenceObjectDefinition" objectGroups="ContentPageFolderItemReferenceGroup" definitionName="plmInheritedContentPageFolderInheritedItemReferenceObjectDefinition" objectType="InheritedContentPageFolderInheritedItemReference" referencedTypes="InheritedContentPage">
            <TrueEnablementCondition conditionType="childObjectCondition"/>
      </CollectionReferenceObjectDefinition>
     
      <!-- The class to represent relationships between folders and Content Page. These relationships are called folder items. -->
      <CollectionReferenceObjectDefinition definitionName="plmBaseContentPageFolderItemReferenceObjectDefinition" isBaseDefinition="true" idProperty="folderItemID" alwaysAllowMove="false">
            <!--- Create service to create the relationship between the parent folder and folder item reference. -->
            <CreateService url="/cmc/CreateFolderItemReference">
                  <ServiceParam name="storeId"/>
                  <ServiceParam name="objectStoreId" parentProperty="true" propertyName="objectStoreId"/>
                  <ServiceParam name="folderItemStoreId" parameterName="folderItemStoreId" propertyName="objectStoreId" objectPath="PageAlias"/>
                  <ServiceParam name="folderId" parentProperty="true" propertyName="folderId"/>
                  <ServiceParam name="folderItemReferenceId" propertyName="pageId" objectPath="PageAlias"/>
            </CreateService>
            
            <!--- Delete service to delete the relationship between the parent folder and folder item reference. -->
            <DeleteService url="/cmc/DeleteFolderItemReference">
                  <ServiceParam name="storeId"/>
                  <ServiceParam name="folderItemStoreId" parameterName="folderItemStoreId" propertyName="objectStoreId" objectPath="PageAlias"/>
                  <ServiceParam name="folderId" parentProperty="true" propertyName="folderId"/>
                  <ServiceParam name="folderItemReferenceId" propertyName="pageId" objectPath="PageAlias"/>
                  <ServiceParam name="folderItemType" propertyName="folderItemType"/>
            </DeleteService>
 
            <TrueEnablementCondition conditionId="objectTypeFolderCondition" conditionType="childObjectCondition"/>
            
            <Xml name="template">
                  <folderItemType>PageType</folderItemType>
            </Xml>           
      </CollectionReferenceObjectDefinition>

</Definitions>

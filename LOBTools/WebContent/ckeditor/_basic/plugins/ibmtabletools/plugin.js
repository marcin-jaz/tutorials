(function(){function u(b,g){for(var h=-1,a=0;a<b.length;a++)if(b[a][g]){h=a;break}if(-1!=h){a=new CKEDITOR.dom.element(b[h][g]);if(a=a.getStyle("width")?a.getStyle("width"):a.getAttribute("width")){if(s.exec(a))return;t.exec(a)&&(a+="px")}else a="0px";for(var c=q.exec(a),a=c[1],i=c[2],e,h=h+1;h<b.length;h++)if(c=b[h][g]?new CKEDITOR.dom.element(b[h][g]):null){var d=c.getStyle("width")?c.getStyle("width"):c.getAttribute("width");if(d){if(s.exec(d))return;t.exec(d)&&(d+="px");c=q.exec(d);e=c[1];c=c[2];
c!=i&&("px"!=c&&(e=CKEDITOR.tools.convertToPx(d)),"px"!=i&&(a=CKEDITOR.tools.convertToPx(a+i),i="px"));e>a&&(a=e)}}return a+i}}function v(b,g,h){var a=q.exec(b),c=a[1],i=a[2],e=m.getStyle("width")?m.getStyle("width"):m.getAttribute("width");if(s.exec(e))return e;t.exec(e)&&(e+="px");if(a=q.exec(e))var d=a[1],a=a[2];else return e;if(i!=a&&("px"!=i&&(c=CKEDITOR.tools.convertToPx(b)),"px"!=a))var d=CKEDITOR.tools.convertToPx(e),f=a,a="px";d=parseFloat(d);c=parseFloat(c);b=h?d>c?d-c:d:d+c*g;if(f){var l;
switch(f){case "in":l=b*w;break;case "cm":l=b*x;break;case "mm":l=b*y;break;case "em":l=b*z;break;case "ex":l=b*A;break;case "pt":l=b*B;break;case "pc":l=b*C}b=Math.round(l*Math.pow(10,2))/Math.pow(10,2);a=f}return b+a}function r(b,g){for(var h=g?Infinity:0,a=0;a<b.length;a++){var c;c=b[a];for(var i=g,e=c.getParent().$.cells,d=0,f=0;f<e.length;f++){var l=e[f],d=d+(i?1:l.colSpan);if(l==c.$)break}c=d-1;if(g?c<h:c>h)h=c}return h}var m,p,q=/^(\d+(?:\.\d+)?)(px|in|cm|mm|em|ex|pt|pc)$/,t=/^(\d+(?:\.\d+)?)$/,
s=/^(\d+(?:\.\d+)?)%$/,w,x,y,z,A,B,C;CKEDITOR.plugins.add("ibmtabletools",{lang:"ar,ca,cs,da,de,el,en,es,fi,fr,he,hr,hu,it,iw,ja,kk,ko,nb,nl,no,pl,pt,pt-br,ro,ru,sk,sl,sv,th,tr,uk,zh,zh-cn,zh-tw",init:function(b){function g(a){var c=a,i=/^<table(.|\n)+<\/table>(<br[^>]*>)?$/i,b=/^<tr(.|\n)+<\/tr>$/i,d=/^<(td|th)(.|\n)+<\/(td|th)>$/gi;this.parse=function(){return!b.test(c)&&!d.test(c)&&!i.test(c)?!1:!0};this.insertRowBefore=function(a){var b=a.getSelection(),d=b.getSelectedElement();b=d&&d instanceof
CKEDITOR.dom.element&&"tr"==d.getName()?d:(b=b.getCommonAncestor())&&b instanceof CKEDITOR.dom.element&&"tr"==b.getName()?b:b.getAscendant("tr")?b.getAscendant("tr"):null;if(b){i.test(c);/<tr(.|\s)+<\/tr>/i.test(c)||(c="<tr>"+c+"</tr>");i.test(c)||(c="<table>"+c+"</table>");for(var a=CKEDITOR.dom.element.createFromHtml(c,a.document),e,d=0;d<a.getChildCount();d++)if(a.getChild(d)instanceof CKEDITOR.dom.element&&("tbody"==a.getChild(d).getName()||"thead"==a.getChild(d).getName())){for(var j=a.getChild(d),
g=0;g<j.getChildCount();g++)if(j.getChild(g)instanceof CKEDITOR.dom.element&&"tr"==j.getChild(g).getName()){e=j.getChild(g);break}if(e)break}for(d=0;d<e.getChildCount();d++)if(e.getChild(d)instanceof CKEDITOR.dom.element&&("td"==e.getChild(d).getName()||"th"==e.getChild(d).getName()))if(1<(e.getChild(d).hasAttribute("rowSpan")?e.getChild(d).getAttribute("rowSpan"):0))return!1;e.insertBefore(b);return!0}return!1}}function h(a){var c=a.data;if("table"==c.getName()&&(a=c.hasAttribute("fixedwidthcolumns")?
c.getAttribute("fixedwidthcolumns"):!1,c.removeAttribute("fixedwidthcolumns"),a)){var a=c.$.rows,b=c.getStyle("width"),c=a[0].childNodes.length,b=/^(\d+(?:\.\d+)?)(px|%|in|cm|mm|em|ex|pt|pc)$/.exec(b),e,d;b&&(e=b[1],d=b[2]);e="%"==d?100:parseFloat(e);var f;"px"!=d&&"pt"!=d&&"mm"!=d?(b=Math.floor(e/c*Math.pow(10,2))/Math.pow(10,2),f=Math.round((e-b*c)*Math.pow(10,2))/Math.pow(10,2)):(b=Math.floor(e/c),f=e%c);e=b+d;d=Math.round((b+f)*Math.pow(10,2))/Math.pow(10,2)+d;for(b=0;b<a.length;b++){f=(new CKEDITOR.dom.element(a[b])).$.cells;
for(var l=0;l<c-1;l++)(new CKEDITOR.dom.element(f[l])).setStyle("width",e);(new CKEDITOR.dom.element(f[c-1])).setStyle("width",d)}}}w=1/CKEDITOR.tools.convertToPx("1in");z=1/CKEDITOR.tools.convertToPx("1em");A=1/CKEDITOR.tools.convertToPx("1ex");C=1/CKEDITOR.tools.convertToPx("1pc");x=100/CKEDITOR.tools.convertToPx("100cm");y=100/CKEDITOR.tools.convertToPx("100mm");B=100/CKEDITOR.tools.convertToPx("100pt");b.addCommand("selectTable",new CKEDITOR.command(b,{requiredContent:"table",exec:function(a){var a=
a.getSelection(),c=a.getCommonAncestor();(c=c?c.getAscendant("table"):null)&&a.selectElement(c)},modes:{wysiwyg:1}}));b.contextMenu.addListener(function(a){return a.hasAscendant("table",1)?b.config.enableTableSort?{select_table:CKEDITOR.TRISTATE_OFF,table_sort:CKEDITOR.TRISTATE_OFF}:{select_table:CKEDITOR.TRISTATE_OFF}:null});b.addCommand("selectTableRow",new CKEDITOR.command(b,{requiredContent:"table",exec:function(a){var a=a.getSelection(),c=a.getCommonAncestor();(c=c&&c.getName&&"tr"==c.getName()?
c:c.getAscendant("tr"))&&a.selectElement(c)},modes:{wysiwyg:1}}));b.addCommand("insertMultipleRows",{requiredContent:"table",exec:function(a,c){for(var b=a.getSelection(),e="before"==c.insertLocation?!0:!1,d=c.noOfRows,f=CKEDITOR.plugins.tabletools.getSelectedCells(b),b=f[0],l=b.getAscendant("table"),b=b.getDocument(),g=f[0].getParent(),k=g.$.rowIndex,f=f[f.length-1],j=f.getParent().$.rowIndex+f.$.rowSpan-1,f=new CKEDITOR.dom.element(l.$.rows[j]),k=e?k:j,g=e?g:f,f=CKEDITOR.tools.buildTableMap(l),
l=f[k],k=e?f[k-1]:f[k+1],f=f[0].length,j=0;j<d;j++){for(var h=b.createElement("tr"),n=0;l[n]&&n<f;n++){var o;1<l[n].rowSpan&&k&&l[n]==k[n]?(o=l[n],o.rowSpan+=1):(o=(new CKEDITOR.dom.element(l[n])).clone(),o.removeAttribute("rowSpan"),!CKEDITOR.env.ie&&o.appendBogus(),h.append(o),o=o.$);n+=o.colSpan-1}e?h.insertBefore(g):h.insertAfter(g)}}});b.addCommand("insertMultipleColumns",{requiredContent:"table",exec:function(a,b){for(var i=a.getSelection(),e="before"==b.insertLocation?!0:!1,d=b.noOfCols,f=
CKEDITOR.plugins.tabletools.getSelectedCells(i),i=f[0].getAscendant("table"),g=r(f,1),f=r(f),h=e?g:f,k=CKEDITOR.tools.buildTableMap(i),i=[],g=[],f=k.length,j=0;j<f;j++){i.push(k[j][h]);var m=e?k[j][h-1]:k[j][h+1];m&&g.push(m)}for(h=0;h<d;h++)for(j=0;j<f;j++)void 0!=i[j]&&(1<i[j].colSpan&&g.length&&g[j]==i[j]?(k=i[j],k.colSpan+=1):(k=(new CKEDITOR.dom.element(i[j])).clone(),k.removeAttribute("colSpan"),!CKEDITOR.env.ie&&k.appendBogus(),k[e?"insertBefore":"insertAfter"].call(k,new CKEDITOR.dom.element(i[j])),
k=k.$),j+=k.rowSpan-1)}});CKEDITOR.dialog.add("insertRows",this.path+"dialogs/insertRows.js");b.addCommand("insertRows",new CKEDITOR.dialogCommand("insertRows",{requiredContent:"table"}));CKEDITOR.dialog.add("insertColumns",this.path+"dialogs/insertColumns.js");b.addCommand("insertCols",new CKEDITOR.dialogCommand("insertColumns",{requiredContent:"table"}));CKEDITOR.dialog.add("columnProperties",this.path+"dialogs/columnProperties.js");b.addCommand("columnProps",new CKEDITOR.dialogCommand("columnProperties",
{allowedContent:"td th{width}",requiredContent:"table{width}"}));CKEDITOR.dialog.add("tablesort",this.path+"dialogs/tablesort.js");b.addCommand("tablesort",new CKEDITOR.dialogCommand("tablesort",{requiredContent:"table"}));b.on("paste",function(a){var b=new g(a.data.dataValue);b.parse()&&b.insertRowBefore(a.editor)&&a.cancel()});b.on("instanceReady",function(){b.on("insertElement",h)});b.on("beforeCommandExec",function(a){if("columnDelete"==a.data.name){var a=a.editor.getSelection(),b=CKEDITOR.plugins.tabletools.getSelectedCells(a);
a:{var a=b[0],i=b[b.length-1];m=a.getAscendant("table");for(var b=CKEDITOR.tools.buildTableMap(m),e,d,f=0,g=b.length;f<g;f++)for(var h=0,k=b[f].length;h<k;h++)b[f][h]==a.$&&(e=h),b[f][h]==i.$&&(d=h);for(var a=0,j,f=e;f<=d;f++){j=u(b,f);if(!j){p=void 0;break a}a+=parseFloat(j)}e=q.exec(j)[2];p=a+e}}});b.on("afterCommandExec",function(a){if("columnInsertAfter"==a.data.name||"columnInsertBefore"==a.data.name||"insertMultipleColumns"==a.data.name){var c=a.editor.getSelection(),i=CKEDITOR.plugins.tabletools.getSelectedCells(c),
c=a.data.commandData&&a.data.commandData.noOfCols?a.data.commandData.noOfCols:1,e="columnInsertBefore"==a.data.name?!0:!1,a=i[0],d=r(i,1),i=r(i),i=e?d:i;m=a.getAscendant("table");a=CKEDITOR.tools.buildTableMap(m);if((p=u(a,i))&&"0px"!=p)m.setStyle("width",v(p,c)),b.fire("updateSnapshot")}else"columnDelete"==a.data.name&&(p&&"0px"!=p)&&(m.setStyle("width",v(p,null,!0)),b.fire("updateSnapshot"))})},afterInit:function(b){if(b.addMenuItems){b.addMenuGroup("tablecolumnproperties");b.addMenuItems({select_table:{label:b.lang.ibmtabletools.selectTable,
command:"selectTable",group:"table",order:2},table_sort:{label:"Sort Table",command:"tablesort",group:"table",order:2},select_tablerow:{label:b.lang.ibmtabletools.selectRow,command:"selectTableRow",group:"tablerow",order:20},insert_rows:{label:b.lang.ibmtabletools.insertMultipleRows,group:"tablerow",command:"insertRows",order:1},insert_cols:{label:b.lang.ibmtabletools.insertMultipleCols,group:"tablecolumn",command:"insertCols",order:1},column_properties:{label:b.lang.ibmtabletools.columnTitle,group:"tablecolumnproperties",
command:"columnProps",order:20}});var g=b.getMenuItem("tablerow"),h=g.getItems;g.getItems=function(){var a=h();a.insert_rows=CKEDITOR.TRISTATE_OFF;a.select_tablerow=CKEDITOR.TRISTATE_OFF;for(var c in a){var d=b.getMenuItem(c);if(-1<d.className.indexOf(" submenuItem"))break;d.className+=" submenuItem"}return a};var g=b.getMenuItem("tablecolumn"),a=g.getItems;g.getItems=function(){var c=a();c.insert_cols=CKEDITOR.TRISTATE_OFF;c.column_properties=CKEDITOR.TRISTATE_OFF;for(var e in c){var d=b.getMenuItem(e);
if(-1<d.className.indexOf(" submenuItem"))break;d.className+=" submenuItem"}return c};var g=b.getMenuItem("tablecell"),c=g.getItems;g.getItems=function(){var a=c(),e;for(e in a){var d=b.getMenuItem(e);if(-1<d.className.indexOf(" submenuItem"))break;d.className+=" submenuItem"}return a}}}})})();